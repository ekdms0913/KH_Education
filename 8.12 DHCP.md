# 8.12 DHCP

1. vim named.ca 이건 뭐지? -> 반복질의? [해결]
-> 포워드에서 root 의 IP 주소를 입력해준다. -> 반복질의를 하기 위해서 ROOT name 서버에 접근하려고
= ROOT HINT 10.10.10.20

2. 왜 naver만 vim /etc/named.1912.zones 에서 
10.10.10.in-addr.arpa 랑 naver.com.rev를 만들어주는지 [굳이 역방향 필요없으니까 선택임]

4. allow-transfer을 none으로 한 이유는?
* allow-transfer = 영역전송 (zone transfer)을 허용할 대상 설정

- none : 모두 거부
- 특정 IP : 설정된 출발지 IP에서만 요청된 영역전송 허용
- any : 안쓰면 any

5. 어제 slave는 뭔지. 
* vim /etc/named.rfc1912.zones
type
- hint : Root hint 동작 수행 -> Cache 전용 서버
- master : 주 네임서버 역할
- slave : 보조 네임서버 역할

file : 지정된 역할을 수행하기 위해 필요한 RRs (Resource Record set)을 가지고 있는 파일의 경로

### DHCP 실습

<DHCP>

일단 아까 named.ca를 날렸기 때문에 다른 서버에서 named.ca 가져오기

```
scp 10.10.10.20:/var/named/named.ca /tmp
yes
cp /tmp/named.ca /var/named
y
chgrp named named.ca
vim named.ca
```

[root@Linux-04 named]# vim /etc/dhcp/dhcpd.conf

```
Subnet 10.10.10.0 netmask 255.255.255.0 {
        range 10.10.10.100 10.10.10.150;
        option routers 10.10.10.254;
        option domain-name-servers 168.126.63.1, 8.8.8.8;
        default-lease-time 86400;
}
```

[root@Linux-04 named]# service dhcpd start
+ 오타 확인 : [root@Linux-04 named]# cat /var/log/messages

[root@Linux-04 named]# netstat -atunp | grep :67

```
udp        0      0 0.0.0.0:67                  0.0.0.0:*                 10406/dhcpd
```

[root@Linux-04 named]#wireshark



<XP>
ncpa.cpl -> IP/DNS 다 자동으로 받아오기 선택 -> cmd 실행 -> ipconfig /all 해서 확인하셈 (Lease time)



<DHCP>
wireshark -> Filter : bootp 

+ IP 할당 해제 : ipconfig /release
+ 쓰던 IP 받아오기 : ipconfig /renew

[root@Linux-04 named]#cat /var/lib/dhcpd/dhcpd.leases



@ipconfig 명령어 

ipconfig -> IP 정보 확인 
ipconfig /all -> IP정보 및 인터페이스 모든 정보 확인
ipconfig /displaydns -> DNS Cache Table 확인 
ipconfig /flushdns -> DNS Cache Table 초기화
ipconfig /release -> IP 주소 할당 해제
ipconfig /renew -> IP 주소 갱신 (리뉴얼)

<root>

[root@Linux-04 named]# vim /etc/sysconfig/network-scripts/ifcfg-eth0

```
DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=no
BOOTPROTO=dhcp    -> 여기 static을 dhcp 동적으로 바꿔줌 
#IPADDR=10.10.10.20 -> 그리고 IP 받아오기 위해 고정되어있던 정보들 주석
#NETMASK=255.255.255.0
#GATEWAY=10.10.10.254
#DNS1=168.126.63.1
#DNS2=8.8.8.8
```

[root@Linux-04 named]# service network restart

```
인터페이스 eth0 (을)를 종료 중:                            [  OK  ]
loopback 인터페이스 종료 중:                               [  OK  ]
loopback 인터페이스 활성화중 입니다:                       [  OK  ]
eth0 인터페이스 활성화중 입니다:  
eth0에 관한 IP 정보를 얻고 있습니다... 완료.
                                                           [  OK  ]
```

[root@Linux-04 named]# ifconfig eth0

```
eth0      Link encap:Ethernet  HWaddr 00:04:56:2E:AB:40  
          inet addr:10.10.10.101  Bcast:10.10.10.255  Mask:255.255.255.0
```



게이트 웨이 주소 보기 -> default 값이 게이트웨이 주소임
[root@Linux-04 named]# route 

```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.10.10.0      *               255.255.255.0   U     0      0        0 eth0
link-local      *               255.255.0.0     U     1002   0        0 eth0
default         10.10.10.254    0.0.0.0         UG    0      0        0 eth0
```

[root@Linux-04 named]# vim /etc/resolv.conf  -> DNS 서버주소 적어주기 

```
; generated by /sbin/dhclient-script
nameserver 168.126.63.1
nameserver 8.8.8.8
```

****서버 IP는 안바뀌는게 제일 좋음 ****


* 정적으로 할당하기 

<DHCP>

[root@Linux-04 바탕화면]# vim /etc/dhcp/dhcpd.conf

```
host rootDNS {
        hardware ethernet 00:04:56:2E:AB:40;   -> 이거 MAC주소는 rootDNS 꺼임
        fixed-address 10.10.10.20;
}
```

[root@Linux-04 바탕화면]# service dhcpd restart




<rootDNS>

[root@Linux-04 named]# service network restart

```
인터페이스 eth0 (을)를 종료 중:                            [  OK  ]
loopback 인터페이스 종료 중:                               [  OK  ]
loopback 인터페이스 활성화중 입니다:                       [  OK  ]
eth0 인터페이스 활성화중 입니다:  
eth0에 관한 IP 정보를 얻고 있습니다... 완료.
                                                           [  OK  ]
```

[root@Linux-04 named]# ifconfig

```
eth0      Link encap:Ethernet  HWaddr 00:04:56:2E:AB:40  
          inet addr:10.10.10.20  Bcast:10.10.10.255  Mask:255.255.255.0
```




 @ ROUTER 에서 IP 할당하기 (=라우터에서 DHCP 설정하기)

<GNS3>
R1(config)#ip dhcp pool test
R1(dhcp-config)#network 10.10.10.0 /24
R1(dhcp-config)#default-router 10.10.10.254
R1(dhcp-config)#dns-server 10.10.10.10 8.8.8.8
R1(dhcp-config)#class scope
R1(config-dhcp-pool-class)#address range 10.10.10.50 10.10.10.80

<XP>
#ipconfig /release
#ipconfig /renew
#ipconfig /all

```
DHCP server : 10.10.10.254
```

<rootDNS>

[root@Linux-04 named]# service network restart

```
인터페이스 eth0 (을)를 종료 중:                            [  OK  ]
loopback 인터페이스 종료 중:                               [  OK  ]
loopback 인터페이스 활성화중 입니다:                       [  OK  ]
eth0 인터페이스 활성화중 입니다:  
eth0에 관한 IP 정보를 얻고 있습니다... 완료.
                                                           [  OK  ]
```

[root@Linux-04 named]# ifconfig

```
eth0      Link encap:Ethernet  HWaddr 00:04:56:2E:AB:40  
          inet addr:10.10.10.51  Bcast:10.10.10.255  Mask:255.255.255.0
```



@@@@@@@@@@100P 실습

rootDNS = VMnet1
DHCP = VMnet2 172.16.10.100/24 172.16.10.254
WinWP = VMnet3

<DHCP>

[root@Linux-04 ~]# vim /etc/dhcp/dhcpd.conf

```
subnet 172.16.10.0 netmask 255.255.255.0 {
        range 172.16.10.50 172.16.10.80;
        option routers 172.16.10.254;
        option domain-name-servers 168.126.63.1;
        default-lease-time 3600;
}

subnet 192.168.10.0 netmask 255.255.255.0 {
        range 192.168.10.150 192.168.10.200;
        option routers 192.168.10.254;
        option domain-name-servers 8.8.8.8;
        default-lease-time 21600;
}

-> 추가해주기
```

[root@Linux-04 ~]# service dhcpd restart



<XP>
#ipconfig /release
#ipconfig /renew



<root DNS>
[root@Linux-04 named]# dhclient -r eth0
[root@Linux-04 ~]# dhclient eth0



@@@@@@@@@@@GNS3에 클라우드 4개 연결 (CentOS, WinXP, DHCP, 외부)
conf t
in f0/0
ip addr 10.10.10.254 255.255.255.0
ip nat in
no sh

in e1/0
ip addr 172.16.10.254 255.255.255.0
ip nat in
no sh

in e1/1
ip addr 192.168.10.254 255.255.255.0
ip nat in
no sh

in f0/1
ip addr 200.200.200.11X 255.255.255.0
ip nat out
no  sh

ip route 0.0.0.0 0.0.0.0 200.200.200.254
access-list 1 permit 10.10.10.0 0.0.0.255
access-list 1 permit 172.16.10.0 0.0.0.255
access-list 1 permit 192.168.10.0 0.0.0.255
ip nat inside source list 1 in f0/1



@@@@@93p DHCP relay agent
<GNS3 R1>

R1(config)#in e1/1
R1(config-if)#ip helper-address 172.16.10.100
R1(config-if)#in f0/0
R1(config-if)#ip helper-address 172.16.10.100

-> 이거 하면 <XP> 에서 ipconfig /release -> ipconfig /renew 하면 
    IP 받아올 수 있음