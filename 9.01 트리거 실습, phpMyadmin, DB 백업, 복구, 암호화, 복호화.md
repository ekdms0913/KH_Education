# 9.1 트리거 실습, phpMyadmin, DB 백업, 복구, 암호화, 복호화

### 실습 트리거 173p

[root@Linux-04 바탕화면]# mysql -u root -pkeroro2424. naver_db

```
mysql> show tables;
+--------------------+
| Tables_in_naver_db |
+--------------------+
| member             |
| trig_test          |
+--------------------+
2 rows in set (0.00 sec)

mysql> create trigger out_mem before delete on member
    -> for each row
    -> insert into out_member values ('',old.id,old.name);
Query OK, 0 rows affected (0.00 sec)

mysql> select * from out_member;
Empty set (0.00 sec)

mysql> delete from member where no=11;
Query OK, 1 row affected, 1 warning (0.01 sec)

mysql> select * from out_member;
+----+-------+-----------+
| no | id    | name      |
+----+-------+-----------+
|  1 | srkim | 김수련    |
+----+-------+-----------+
1 row in set (0.00 sec)

mysql> delete from member where no=2;
Query OK, 1 row affected, 1 warning (0.00 sec)

mysql> select * from member where no=2;
Empty set (0.00 sec)

mysql> select * from out_member;
+----+--------+-----------+
| no | id     | name      |
+----+--------+-----------+
|  1 | srkim  | 김수련    |
|  2 | khshul | 설기형    |
+----+--------+-----------+
2 rows in set (0.00 sec)


```

### MYSQL

###### WebMail

```
mysql> select user, host, password from mysql.user;   // 원격 접속 가능한거
+-----------+---------------+-------------------------------------------+
| user      | host          | password                                  |
+-----------+---------------+-------------------------------------------+
| root      | localhost     | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | linux-04      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | 127.0.0.1     | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| kuser1    | localhost     | *A4B6157319038724E3560894F7F932C8886EBFCF |
| root      | 100.100.100.% | *A4B6157319038724E3560894F7F932C8886EBFCF |
| testuser1 | localhost     | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| testuser2 | localhost     | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
+-----------+---------------+-------------------------------------------+
7 rows in set (0.00 sec)

root 지우고 싶어

mysql> drop user root@'100.100.100.%';
Query OK, 0 rows affected (0.00 sec)

mysql> select user, host, password from mysql.user;
+-----------+-----------+-------------------------------------------+
| user      | host      | password                                  |
+-----------+-----------+-------------------------------------------+
| root      | localhost | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | linux-04  | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | 127.0.0.1 | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| kuser1    | localhost | *A4B6157319038724E3560894F7F932C8886EBFCF |
| testuser1 | localhost | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| testuser2 | localhost | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
+-----------+-----------+-------------------------------------------+
6 rows in set (0.00 sec)

100.100.100.50 (WebClient)만 접속가능하게 해줄거야
권한 grant로 부여할거야

mysql> grant all privileges on *.* to root@100.100.100.50
    -> identified by 'P@ssw0rd';
Query OK, 0 rows affected (0.00 sec)

mysql> select user, host, password from mysql.user;
+-----------+----------------+-------------------------------------------+
| user      | host           | password                                  |
+-----------+----------------+-------------------------------------------+
| root      | localhost      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | linux-04       | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | 127.0.0.1      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| kuser1    | localhost      | *A4B6157319038724E3560894F7F932C8886EBFCF |
| root      | 100.100.100.50 | *8232A1298A49F710DBEE0B330C42EEC825D4190A |  //정확히는
| testuser1 | localhost      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |  저건 WAS 의 IP
| testuser2 | localhost      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC | 100.100.100.50
+-----------+----------------+-------------------------------------------+ 혹은 DBA 의 IP
7 rows in set (0.00 sec)

계정정보 바꿀 땐 항상 바꾸고 flush privileges 해주기

mysql> flush privileges;
Query OK, 0 rows affected (0.01 sec)

권한 준거 확인

mysql> show grants for root@100.100.100.50
    -> ;
+---------------------------------------------------------------------------------------------------------------------------+
| Grants for root@100.100.100.50                                                                                            |
+---------------------------------------------------------------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'100.100.100.50' IDENTIFIED BY PASSWORD '*8232A1298A49F710DBEE0B330C42EEC825D4190A' |
+---------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)



```

###### WebClient

```
[root@Linux-04 바탕화면]# rpm -qa | grep mysql
mysql-5.1.73-8.el6_8.x86_64
mysql-libs-5.1.73-8.el6_8.x86_64

[root@Linux-04 바탕화면]# mysql -h 100.100.100.10 -u root -pP@ssw0rd

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| TestDB             |
| artist_db          |
| bns                |
| entest             |
| entest2            |
| khacademy          |
| mysql              |
| naver_db           |
| sns                |
| test               |
+--------------------+
11 rows in set (0.01 sec)

```

### phpMyAdmin

https://www.phpmyadmin.net/downloads/ 접속 -> 우리MySQL은 5.1임 버전 잘 보고 다운받아야해

-> 근데 강사님이 그냥 파일로 주심 -> WebMail 바탕화면에 복붙

###### WebMail

[root@Linux-04 바탕화면]# rpm -qa | grep httpd

```
httpd-tools-2.2.15-45.el6.centos.x86_64
httpd-2.2.15-45.el6.centos.x86_64
```

[root@Linux-04 바탕화면]# rpm -qa | grep php // 없어... 깔기

[root@Linux-04 바탕화면]# yum -y install php php-mbstring php-mysql

[root@Linux-04 바탕화면]# mkdir /var/www/html/phpmyadmin

[root@Linux-04 바탕화면]# ls -l /var/www/html
합계 8
drwxr-xr-x 2 root root 4096 2020-09-01 11:41 phpmyadmin

[root@Linux-04 바탕화면]# ls -l /var/www/html
합계 4
drwxr-xr-x 2 root root 4096 2020-09-01 11:41 phpmyadmin

[root@Linux-04 바탕화면]# tar xfz phpMyAdmin-3.5.1-all-languages.tar.gz -C /var/www/html/phpmyadmin/c

[root@Linux-04 바탕화면]# cd /var/www/html/phpmyadmin/

[root@Linux-04 phpmyadmin]# ls
phpMyAdmin-3.5.1-all-languages

[root@Linux-04 phpmyadmin]# ls phpMyAdmin-3.5.1-all-languages/

```
ChangeLog                 db_routines.php      navigation.php         server_import.php          tbl_move_copy.php
Documentation.html        db_search.php        phpinfo.php            server_plugins.php         tbl_operations.php
Documentation.txt         db_sql.php           phpmyadmin.css.php     server_privileges.php      tbl_printview.php
LICENSE                   db_structure.php     pmd_display_field.php  server_replication.php     tbl_relation.php
README                    db_tracking.php      pmd_general.php        server_sql.php             tbl_replace.php
README.VENDOR             db_triggers.php      pmd_pdf.php            server_status.php          tbl_row_action.php
RELEASE-DATE-3.5.1        docs.css             pmd_relation_new.php   server_synchronize.php     tbl_select.php
browse_foreigners.php     enum_editor.php      pmd_relation_upd.php   server_variables.php       tbl_sql.php
bs_disp_as_mime_type.php  examples             pmd_save_pos.php       setup                      tbl_structure.php
bs_play_media.php         export.php           prefs_forms.php        show_config_errors.php     tbl_tracking.php
changelog.php             favicon.ico          prefs_manage.php       sql.php                    tbl_triggers.php
chk_rel.php               file_echo.php        print.css              tbl_addfield.php           tbl_zoom_select.php
config.sample.inc.php     gis_data_editor.php  querywindow.php        tbl_alter.php              themes
db_create.php             import.php           robots.txt             tbl_change.php             themes.php
db_datadict.php           import_status.php    schema_edit.php        tbl_chart.php              transformation_overview.php
db_events.php             index.php            schema_export.php      tbl_create.php             transformation_wrapper.php
db_export.php             js                   server_binlog.php      tbl_export.php             url.php
db_import.php             libraries            server_collations.php  tbl_get_field.php          user_password.php
db_operations.php         license.php          server_databases.php   tbl_gis_visualization.php  view_create.php
db_printview.php          locale               server_engines.php     tbl_import.php             view_operations.php
db_qbe.php                main.php             server_export.php      tbl_indexes.php            webapp.php




```

[root@Linux-04 phpmyadmin]# mv phpMyAdmin-3.5.1-all-languages/* ./
[root@Linux-04 phpmyadmin]# ls

```
ChangeLog                 db_search.php                   phpinfo.php            server_privileges.php      tbl_relation.php
Documentation.html        db_sql.php                      phpmyadmin.css.php     server_replication.php     tbl_replace.php
Documentation.txt         db_structure.php                pmd_display_field.php  server_sql.php             tbl_row_action.php
LICENSE                   db_tracking.php                 pmd_general.php        server_status.php          tbl_select.php
README                    db_triggers.php                 pmd_pdf.php            server_synchronize.php     tbl_sql.php
README.VENDOR             docs.css                        pmd_relation_new.php   server_variables.php       tbl_structure.php
RELEASE-DATE-3.5.1        enum_editor.php                 pmd_relation_upd.php   setup                      tbl_tracking.php
browse_foreigners.php     examples                        pmd_save_pos.php       show_config_errors.php     tbl_triggers.php
bs_disp_as_mime_type.php  export.php                      prefs_forms.php        sql.php                    tbl_zoom_select.php
bs_play_media.php         favicon.ico                     prefs_manage.php       tbl_addfield.php           themes
changelog.php             file_echo.php                   print.css              tbl_alter.php              themes.php
chk_rel.php               gis_data_editor.php             querywindow.php        tbl_change.php             transformation_overview.php
config.sample.inc.php     import.php                      robots.txt             tbl_chart.php              transformation_wrapper.php
db_create.php             import_status.php               schema_edit.php        tbl_create.php             url.php
db_datadict.php           index.php                       schema_export.php      tbl_export.php             user_password.php
db_events.php             js                              server_binlog.php      tbl_get_field.php          view_create.php
db_export.php             libraries                       server_collations.php  tbl_gis_visualization.php  view_operations.php
db_import.php             license.php                     server_databases.php   tbl_import.php             webapp.php
db_operations.php         locale                          server_engines.php     tbl_indexes.php
db_printview.php          main.php                        server_export.php      tbl_move_copy.php
db_qbe.php                navigation.php                  server_import.php      tbl_operations.php
db_routines.php           phpMyAdmin-3.5.1-all-languages  server_plugins.php     tbl_printview.php

```

[root@Linux-04 phpmyadmin]# service httpd restart

파이어폭스 -> http://localhost/phpmyadmin/ -> DB 아이디랑 비번으로 로그인 ( root / keroro2424.)



http://dev.mysql.com/downloads/workbench/ -> HOST PC에 설치하기



[root@Linux-04 phpmyadmin]# mysql -u root -pkeroro2424. 

```
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| TestDB             |
| artist_db          |
| bns                |
| khacademy          |
| mysql              |
| naver_db           |
| sns                |
| test               |
+--------------------+
9 rows in set (0.00 sec)


mysql> grant all privileges on *.* to kuser@100.100.100.1
    -> identified by '1234';
Query OK, 0 rows affected (0.03 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.01 sec)

생성된거 확인


mysql> select user, host, password from mysql.user;
+-----------+----------------+-------------------------------------------+
| user      | host           | password                                  |
+-----------+----------------+-------------------------------------------+
| root      | localhost      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | linux-04       | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| root      | 127.0.0.1      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| kuser1    | localhost      | *A4B6157319038724E3560894F7F932C8886EBFCF |
| root      | 100.100.100.50 | *8232A1298A49F710DBEE0B330C42EEC825D4190A |
| testuser1 | localhost      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| testuser2 | localhost      | *A849201DB02204C54339B1AF6F0E3BEF14EE74BC |
| kuser     | 100.100.100.1  | *A4B6157319038724E3560894F7F932C8886EBFCF |
+-----------+----------------+-------------------------------------------+
8 rows in set (0.01 sec)

```



돌고래

![image-20200901143549332](C:\Users\82102\AppData\Roaming\Typora\typora-user-images\image-20200901143549332.png)

![image-20200901154525941](C:\Users\82102\AppData\Roaming\Typora\typora-user-images\image-20200901154525941.png)

File - New File - Add Diagram  하면 ER 다이어그램 만들 수 있음 



### DB 백업 191p

[root@Linux-04 phpmyadmin]# mkdir /db_backup
[root@Linux-04 phpmyadmin]# cd /db_backup/
[root@Linux-04 db_backup]# mysqldump -u root -p --all-databases > alldb.sql
Enter password: 
-- Warning: Skipping the data of table mysql.event. Specify the --events option explicitly.  

-> MySQL DB 백업시에는  Event 옵션 추가해줘야함!

[root@Linux-04 db_backup]# mysqldump -u root -p --all-databases --events > alldb.sql
Enter password: 
[root@Linux-04 db_backup]# ls

```
alldb.sql  // 백업파일 생성 완료
```

[root@Linux-04 db_backup]# vim alldb.sql



#### 내가 원하는 DB만 백업하고 싶을 때

[root@Linux-04 db_backup]# mysqldump -u root -p --databases naver_db bns > naver_bns.sql
Enter password: 
[root@Linux-04 db_backup]# ls

```
alldb.sql  naver_bns.sql
```

[root@Linux-04 db_backup]# vim naver_bns.sql



[root@Linux-04 db_backup]# mysqldump -u root -p naver_db bns > naver_bns2.sql
Enter password: 
mysqldump: Couldn't find table: "bns"

->옵션 안넣으면  하나밖에 지정 안됨. 둘 중 하나만 백업 가능



[root@Linux-04 db_backup]# mysqldump -u root -p naver_db > naver.sql
Enter password: 
[root@Linux-04 db_backup]# ls

```
alldb.sql  naver.sql  naver_bns.sql  naver_bns2.sql
```

[root@Linux-04 db_backup]# vim naver.sql



#### 테이블도 백업 가능

[root@Linux-04 db_backup]# mysqldump -u root -p naver_db member > naver_mem.sql
Enter password: 
[root@Linux-04 db_backup]# ls

```
alldb.sql  naver.sql  naver_bns.sql  naver_bns2.sql  naver_mem.sql
```

[root@Linux-04 db_backup]# vim naver_mem.sql



[root@Linux-04 db_backup]# mysqldump -u root -p naver_db member -w age=20 > naver_mem_age_20.sql
Enter password: 
[root@Linux-04 db_backup]# vim naver_mem_age_20.sql



#### 레코드 자체를 다 뺄 수도 있다

[root@Linux-04 db_backup]# mysqldump -u root -p --no-data naver_db > naver_no_data.sql
Enter password: 
[root@Linux-04 db_backup]# vim naver_no_data.sql



#### 문자열로 할 경우 "" 이용하기 

[root@Linux-04 db_backup]# mysqldump -u root -p bns market -w "m_seller='evernick'" > bns_market.sql
Enter password: 
[root@Linux-04 db_backup]# vim bns_market.sql

[root@Linux-04 db_backup]# mysqldump -u root -p bns sword -w "s_name='염화검'" > bns_sword.sql
Enter password: 
[root@Linux-04 db_backup]# vim bns_sword.sql



### DB 날리기

[root@Linux-04 db_backup]# mysql -u root -pkeroro2424.

```
mysql> drop database naver_db;
Query OK, 3 rows affected (0.04 sec)

mysql> exit
Bye
```

### DB 복구

[root@Linux-04 db_backup]# mysql -u root -p < naver_bns.sql
Enter password: 

[root@Linux-04 db_backup]# mysql -u root -pkeroro2424.

```
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| TestDB             |
| artist_db          |
| bns                |
| khacademy          |
| mysql              |
| naver_db           |
| php_db             |
| sns                |
| test               |
+--------------------+
10 rows in set (0.00 sec)

mysql> use naver_db;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+--------------------+
| Tables_in_naver_db |
+--------------------+
| member             |
| out_member         |
| trig_test          |
+--------------------+
3 rows in set (0.00 sec)

mysql> select * from member;
+----+---------+--------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)


```



### 암호화 194 p

#### 단방향

```

mysql> use naver_db;
Database changed
mysql> desc member;
+----------+-------------+------+-----+---------+----------------+
| Field    | Type        | Null | Key | Default | Extra          |
+----------+-------------+------+-----+---------+----------------+
| no       | int(11)     | NO   | PRI | NULL    | auto_increment |
| id       | varchar(10) | NO   | UNI | NULL    |                |
| name     | varchar(20) | NO   |     | NULL    |                |
| sex      | char(1)     | YES  |     | NULL    |                |
| post_num | char(8)     | YES  |     | NULL    |                |
| address  | varchar(80) | YES  |     | NULL    |                |
| tel      | varchar(15) | YES  |     | NULL    |                |
| age      | int(11)     | YES  |     | NULL    |                |
+----------+-------------+------+-----+---------+----------------+
8 rows in set (0.00 sec)

일단 암호가 없어서 테이블 하나 추가해줌 

mysql> alter table member add pass varchar(50) not null default 'qwer1234' after name;
Query OK, 14 rows affected (0.02 sec)
Records: 14  Duplicates: 0  Warnings: 0

mysql> select * from member;
+----+---------+--------------+----------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass     | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+----------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | qwer1234 | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | qwer1234 | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | qwer1234 | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | qwer1234 | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | qwer1234 | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234 | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | qwer1234 | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234 | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234 | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234 | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234 | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234 | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234 | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234 | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+----------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)

md5 를 통해 암호화 시키기 (해시함수)

mysql> update member set pass=md5('qwer1234') where no=1;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from member;
+----+---------+--------------+----------------------------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass                             | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+----------------------------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 5d93ceb70e2bf5daa84ec3d0cd2c731a | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | qwer1234                         | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | qwer1234                         | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | qwer1234                         | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | qwer1234                         | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234                         | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | qwer1234                         | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234                         | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234                         | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234                         | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234                         | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234                         | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234                         | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234                         | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+----------------------------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)

알고리즘은 똑같기 때문에 같은 값 출력

mysql> update member set pass=md5('qwer1234') where no=3;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from member;
+----+---------+--------------+----------------------------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass                             | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+----------------------------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 5d93ceb70e2bf5daa84ec3d0cd2c731a | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | 5d93ceb70e2bf5daa84ec3d0cd2c731a | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | qwer1234                         | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | qwer1234                         | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | qwer1234                         | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234                         | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | qwer1234                         | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234                         | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234                         | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234                         | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234                         | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234                         | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234                         | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234                         | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+----------------------------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)

sha1 는 암호가 더 길다.

mysql> update member set pass=sha1('qwer1234') where no=4;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from member;
+----+---------+--------------+------------------------------------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass                                     | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+------------------------------------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 5d93ceb70e2bf5daa84ec3d0cd2c731a         | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | 5d93ceb70e2bf5daa84ec3d0cd2c731a         | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | db25f2fc14cd2d2b1e7af307241f548fb03c312a | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | qwer1234                                 | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | qwer1234                                 | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234                                 | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | qwer1234                                 | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234                                 | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234                                 | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234                                 | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234                                 | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234                                 | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234                                 | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234                                 | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+------------------------------------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)

Password 이용하면 똑같음

mysql> update member set pass=password('qwer1234') where no=5;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from member;
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass                                      | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 5d93ceb70e2bf5daa84ec3d0cd2c731a          | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | 5d93ceb70e2bf5daa84ec3d0cd2c731a          | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | db25f2fc14cd2d2b1e7af307241f548fb03c312a  | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | *D75CC763C5551A420D28A227AC294FADE26A2FF2 | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | qwer1234                                  | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234                                  | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | qwer1234                                  | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234                                  | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234                                  | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234                                  | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234                                  | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234                                  | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234                                  | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234                                  | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)

mysql> update member set pass=password('qwer1234') where no=6;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from member;
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass                                      | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 5d93ceb70e2bf5daa84ec3d0cd2c731a          | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | 5d93ceb70e2bf5daa84ec3d0cd2c731a          | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | db25f2fc14cd2d2b1e7af307241f548fb03c312a  | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | *D75CC763C5551A420D28A227AC294FADE26A2FF2 | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | *D75CC763C5551A420D28A227AC294FADE26A2FF2 | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234                                  | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | qwer1234                                  | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234                                  | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234                                  | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234                                  | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234                                  | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234                                  | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234                                  | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234                                  | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)



```

##### 둘이 똑같아

```
mysql> select password ('hello');
+-------------------------------------------+
| password ('hello')                        |
+-------------------------------------------+
| *6B4F89A54E2D27ECD7E8DA05B4AB8FD9D1D8B119 |
+-------------------------------------------+
1 row in set (0.00 sec)

mysql> select concat('*', convert (sha1(unhex(sha1('hello'))) using utf8));
+--------------------------------------------------------------+
| concat('*', convert (sha1(unhex(sha1('hello'))) using utf8)) |
+--------------------------------------------------------------+
| *6b4f89a54e2d27ecd7e8da05b4ab8fd9d1d8b119                    |
+--------------------------------------------------------------+
1 row in set (0.01 sec)

순서 : sha1 (16진수) -> unhex (16진수를 10진수로 변환) -> sha1 (16진수로 변환) -> convert (표현방식을 utf8로 바꿔줌 -> * (앞에 *를 붙힘))
```



##### 단 저장컬럼의 데이터 타입 용량이 부족하면 해시 값이 용량만큼만 저장된다. 

```
mysql> desc member;
+----------+-------------+------+-----+----------+----------------+
| Field    | Type        | Null | Key | Default  | Extra          |
+----------+-------------+------+-----+----------+----------------+
| no       | int(11)     | NO   | PRI | NULL     | auto_increment |
| id       | varchar(10) | NO   | UNI | NULL     |                |
| name     | varchar(20) | NO   |     | NULL     |                |
| pass     | varchar(50) | NO   |     | qwer1234 |                | // 여기 용량!
| sex      | char(1)     | YES  |     | NULL     |                |
| post_num | char(8)     | YES  |     | NULL     |                |
| address  | varchar(80) | YES  |     | NULL     |                |
| tel      | varchar(15) | YES  |     | NULL     |                |
| age      | int(11)     | YES  |     | NULL     |                |
+----------+-------------+------+-----+----------+----------------+
9 rows in set (0.00 sec)

```



#### 양방향

```
mysql> update member set pass=hex(aes_encrypt('qwer1234','keroro')) where no = 8;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> update member set pass=hex(aes_encrypt('qwer1234','keroro')) where no = 8;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from member;
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name         | pass                                      | sex  | post_num | address                                 | tel       | age  |
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주       | 5d93ceb70e2bf5daa84ec3d0cd2c731a          | 남   | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  3 | chpark  | 박철호       | 5d93ceb70e2bf5daa84ec3d0cd2c731a          | 남   | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈       | db25f2fc14cd2d2b1e7af307241f548fb03c312a  | 남   | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙       | *D75CC763C5551A420D28A227AC294FADE26A2FF2 | 여   | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진       | *D75CC763C5551A420D28A227AC294FADE26A2FF2 | 남   | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈       | qwer1234                                  | 여   | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수       | 5B79092D889C94C68E075B2260DC3DA5          | 남   | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길       | qwer1234                                  | 남   | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수       | qwer1234                                  | 남   | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 13 | hnjang  | 정한나       | qwer1234                                  | 여   | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연       | qwer1234                                  | 여   | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙       | qwer1234                                  | 여   | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수       | qwer1234                                  | 남   | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저     | qwer1234                                  | 여   | 111-111  | 인천시 연수구 옥력동                    | 1234-1234 |   30 |
+----+---------+--------------+-------------------------------------------+------+----------+-----------------------------------------+-----------+------+
14 rows in set (0.00 sec)



```

##### 복호화

```
mysql> desc member;
+----------+-------------+------+-----+----------+----------------+
| Field    | Type        | Null | Key | Default  | Extra          |
+----------+-------------+------+-----+----------+----------------+
| no       | int(11)     | NO   | PRI | NULL     | auto_increment |
| id       | varchar(10) | NO   | UNI | NULL     |                |
| name     | varchar(20) | NO   |     | NULL     |                |
| pass     | varchar(50) | NO   |     | qwer1234 |                |
| sex      | char(1)     | YES  |     | NULL     |                |
| post_num | char(8)     | YES  |     | NULL     |                |
| address  | varchar(80) | YES  |     | NULL     |                |
| tel      | varchar(15) | YES  |     | NULL     |                |
| age      | int(11)     | YES  |     | NULL     |                |
+----------+-------------+------+-----+----------+----------------+
9 rows in set (0.01 sec)

mysql> select no,id,name,aes_decrypt(unhex(pass),'keroro') as pass from member where no=8;
+----+-------+-----------+----------+
| no | id    | name      | pass     |
+----+-------+-----------+----------+
|  8 | mskim | 김문수    | qwer1234 |
+----+-------+-----------+----------+
1 row in set (0.00 sec)

-> 복화화는 복호화 함수먼저 나옴 그리고 키 값 다르면 안나옴! Null 값 나옴
이런식으로 나옴

mysql> select no,id,name,aes_decrypt(unhex(pass),'kero') as pass from member where no=8;
+----+-------+-----------+------+
| no | id    | name      | pass |
+----+-------+-----------+------+
|  8 | mskim | 김문수    | NULL |
+----+-------+-----------+------+
1 row in set (0.00 sec)



```





























