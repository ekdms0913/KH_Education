# 8.31 View, 트랜잭션, Delimiter, 트리거

### 뷰 119p

채팅방에서 artisdb 다운 -> 압축풀고 WebMail 바탕화면에 복붙

[root@Linux-04 바탕화면]# mysql -u root -pkeroro2424. < artistdb.sql
[root@Linux-04 바탕화면]# mysql -u root -pkeroro2424. artist_db

```
mysql> show tables;
+---------------------+
| Tables_in_artist_db |
+---------------------+
| art_board           |
| art_member          |
+---------------------+
2 rows in set (0.00 sec)

mysql> desc art_member;
+--------+------------------+------+-----+---------+----------------+
| Field  | Type             | Null | Key | Default | Extra          |
+--------+------------------+------+-----+---------+----------------+
| u_no   | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| u_id   | varchar(20)      | NO   | UNI | NULL    |                |
| u_pass | varchar(50)      | NO   |     | NULL    |                |
| u_name | varchar(20)      | NO   |     | NULL    |                |
| u_age  | int(10) unsigned | YES  |     | NULL    |                |
+--------+------------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

mysql> desc art_board;
+------------+------------------+------+-----+---------+----------------+
| Field      | Type             | Null | Key | Default | Extra          |
+------------+------------------+------+-----+---------+----------------+
| b_no       | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| b_id       | varchar(20)      | NO   |     | NULL    |                |
| b_subject  | varchar(100)     | NO   |     | NULL    |                |
| b_contents | text             | NO   |     | NULL    |                |
| reg_date   | datetime         | YES  |     | NULL    |                |
+------------+------------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

mysql> select * from art_member;
+------+---------+----------+-----------+-------+
| u_no | u_id    | u_pass   | u_name    | u_age |
+------+---------+----------+-----------+-------+
|    1 | bogummy | bogobogo | 박보검    |    24 |
|    2 | joongki | s1234    | 송중기    |    32 |
|    3 | hyekyo  | hkhk     | 송혜교    |    36 |
|    4 | parkbo  | boyoung  | 박보영    |    27 |
|    5 | parkhj  | park     | 박해진    |    35 |
|    6 | ksh     | shkim    | 김수현    |    30 |
|    7 | jihyun  | jenjh    | 전지현    |    36 |
|    8 | taehee  | rainth   | 김태희    |    37 |
+------+---------+----------+-----------+-------+
8 rows in set (0.00 sec)

mysql> select * from art_board;
+------+---------+------------------------+---------------------------+---------------------+
| b_no | b_id    | b_subject              | b_contents                | reg_date            |
+------+---------+------------------------+---------------------------+---------------------+
|    1 | bogummy | 핫뉴스~!!              | 보검이왔어요~!!           | 2020-08-31 09:15:44 |
|    2 | ksh     | 하이염~!               | 수현이예요~~              | 2020-08-31 09:15:44 |
|    3 | parkhj  | 안녕하세요             | 반가워요~^^               | 2020-08-31 09:15:44 |
|    4 | hyekyo  | 혜교예요~              | 혜교이뻐해주세요~         | 2020-08-31 09:15:44 |
|    5 | parkhj  | 꼭 읽어주세요~!!       | 나 좀 멋진듯~?            | 2020-08-31 09:15:44 |
+------+---------+------------------------+---------------------------+---------------------+
5 rows in set (0.00 sec)

mysql> show tables;
+---------------------+
| Tables_in_artist_db |
+---------------------+
| art_board           |
| art_board_list      |
| art_member          |
+---------------------+
3 rows in set (0.00 sec)

mysql> desc art_board_list;
+-----------+--------------+------+-----+---------+-------+
| Field     | Type         | Null | Key | Default | Extra |
+-----------+--------------+------+-----+---------+-------+
| b_subject | varchar(100) | NO   |     | NULL    |       |
| u_name    | varchar(20)  | NO   |     | NULL    |       |
| reg_date  | datetime     | YES  |     | NULL    |       |
+-----------+--------------+------+-----+---------+-------+
3 rows in set (0.00 sec)

mysql> select * from art_board_list;
+------------------------+-----------+---------------------+
| b_subject              | u_name    | reg_date            |
+------------------------+-----------+---------------------+
| 핫뉴스~!!              | 박보검    | 2020-08-31 09:15:44 |
| 하이염~!               | 김수현    | 2020-08-31 09:15:44 |
| 안녕하세요             | 박해진    | 2020-08-31 09:15:44 |
| 혜교예요~              | 송혜교    | 2020-08-31 09:15:44 |
| 꼭 읽어주세요~!!       | 박해진    | 2020-08-31 09:15:44 |
+------------------------+-----------+---------------------+
5 rows in set (0.03 sec)


```

#### Alter

```
alter 이용해서 b_no 추가하기

mysql> alter view art_board_list as
    -> select b_no, b_subject, u_name, reg_date from art_board
    -> join art_member on b_id=u_id;
Query OK, 0 rows affected (0.00 sec)

mysql> desc art_board_list;
+-----------+------------------+------+-----+---------+-------+
| Field     | Type             | Null | Key | Default | Extra |
+-----------+------------------+------+-----+---------+-------+
| b_no      | int(10) unsigned | NO   |     | 0       |       |
| b_subject | varchar(100)     | NO   |     | NULL    |       |
| u_name    | varchar(20)      | NO   |     | NULL    |       |
| reg_date  | datetime         | YES  |     | NULL    |       |
+-----------+------------------+------+-----+---------+-------+
4 rows in set (0.00 sec)



```

#### Insert 원본테이블에 추가하기 (6번째 레코드)

```
mysql> insert into art_board values
    -> ('','parkbo','보영임당~','겸둥이보영이에요~!',now());
Query OK, 1 row affected, 1 warning (0.00 sec)

mysql> select * from art_board;
+------+---------+------------------------+----------------------------+---------------------+
| b_no | b_id    | b_subject              | b_contents                 | reg_date            |
+------+---------+------------------------+----------------------------+---------------------+
|    1 | bogummy | 핫뉴스~!!              | 보검이왔어요~!!            | 2020-08-31 09:15:44 |
|    2 | ksh     | 하이염~!               | 수현이예요~~               | 2020-08-31 09:15:44 |
|    3 | parkhj  | 안녕하세요             | 반가워요~^^                | 2020-08-31 09:15:44 |
|    4 | hyekyo  | 혜교예요~              | 혜교이뻐해주세요~          | 2020-08-31 09:15:44 |
|    5 | parkhj  | 꼭 읽어주세요~!!       | 나 좀 멋진듯~?             | 2020-08-31 09:15:44 |
|    6 | parkbo  | 보영임당~              | 겸둥이보영이에요~!         | 2020-08-31 09:27:37 |
+------+---------+------------------------+----------------------------+---------------------+
6 rows in set (0.00 sec)

원본테이블에 값이 추가되었을 경우 view랑 조건이 일치하면 view에도 자동으로 추가됨

mysql> select * from art_board_list;
+------+------------------------+-----------+---------------------+
| b_no | b_subject              | u_name    | reg_date            |
+------+------------------------+-----------+---------------------+
|    1 | 핫뉴스~!!              | 박보검    | 2020-08-31 09:15:44 |
|    2 | 하이염~!               | 김수현    | 2020-08-31 09:15:44 |
|    3 | 안녕하세요             | 박해진    | 2020-08-31 09:15:44 |
|    4 | 혜교예요~              | 송혜교    | 2020-08-31 09:15:44 |
|    5 | 꼭 읽어주세요~!!       | 박해진    | 2020-08-31 09:15:44 |
|    6 | 보영임당~              | 박보영    | 2020-08-31 09:27:37 |
+------+------------------------+-----------+---------------------+
6 rows in set (0.00 sec)
```



#### 원본테이블이 아닌 뷰에 데이터를 집어넣는다면? 오류뜸  124p 

왜?  -> view는 하나 이상의 테이블에서 데이터를 가져와 만들 수 있기 때문에 데이터 입력에 제한이 있다.

= 두개의 테이블에서 가져왔기 때문!

```
mysql> insert into art_board_list values
    -> ('','보영임당~','박보영',now());
ERROR 1394 (HY000): Can not insert into join view 'artist_db.art_board_list' without fields list
```

#### Update 125P

```
mysql> update art_board set b_subject='[끌올]혜교에요~' where b_no=4;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from art_board;
+------+---------+------------------------+----------------------------+---------------------+
| b_no | b_id    | b_subject              | b_contents                 | reg_date            |
+------+---------+------------------------+----------------------------+---------------------+
|    1 | bogummy | 핫뉴스~!!              | 보검이왔어요~!!            | 2020-08-31 09:15:44 |
|    2 | ksh     | 하이염~!               | 수현이예요~~               | 2020-08-31 09:15:44 |
|    3 | parkhj  | 안녕하세요             | 반가워요~^^                | 2020-08-31 09:15:44 |
|    4 | hyekyo  | [끌올]혜교에요~        | 혜교이뻐해주세요~          | 2020-08-31 09:15:44 |
|    5 | parkhj  | 꼭 읽어주세요~!!       | 나 좀 멋진듯~?             | 2020-08-31 09:15:44 |
|    6 | parkbo  | 보영임당~              | 겸둥이보영이에요~!         | 2020-08-31 09:27:37 |
+------+---------+------------------------+----------------------------+---------------------+
6 rows in set (0.00 sec)

mysql> select * from art_board_list;
+------+------------------------+-----------+---------------------+
| b_no | b_subject              | u_name    | reg_date            |
+------+------------------------+-----------+---------------------+
|    1 | 핫뉴스~!!              | 박보검    | 2020-08-31 09:15:44 |
|    2 | 하이염~!               | 김수현    | 2020-08-31 09:15:44 |
|    3 | 안녕하세요             | 박해진    | 2020-08-31 09:15:44 |
|    4 | [끌올]혜교에요~        | 송혜교    | 2020-08-31 09:15:44 |
|    5 | 꼭 읽어주세요~!!       | 박해진    | 2020-08-31 09:15:44 |
|    6 | 보영임당~              | 박보영    | 2020-08-31 09:27:37 |
+------+------------------------+-----------+---------------------+
6 rows in set (0.00 sec)

View 에서 Update 하면 원본 테이블에도 update 된다
mysql> update art_board_list set b_subject='읽지마세요~' where b_no=5;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from art_board_list;
+------+-----------------------+-----------+---------------------+
| b_no | b_subject             | u_name    | reg_date            |
+------+-----------------------+-----------+---------------------+
|    1 | 핫뉴스~!!             | 박보검    | 2020-08-31 09:15:44 |
|    2 | 하이염~!              | 김수현    | 2020-08-31 09:15:44 |
|    3 | 안녕하세요            | 박해진    | 2020-08-31 09:15:44 |
|    4 | [끌올]혜교에요~       | 송혜교    | 2020-08-31 09:15:44 |
|    5 | 읽지마세요~           | 박해진    | 2020-08-31 09:15:44 |
|    6 | 보영임당~             | 박보영    | 2020-08-31 09:27:37 |
+------+-----------------------+-----------+---------------------+
6 rows in set (0.00 sec)

mysql> select * from art_board;
+------+---------+-----------------------+----------------------------+---------------------+
| b_no | b_id    | b_subject             | b_contents                 | reg_date            |
+------+---------+-----------------------+----------------------------+---------------------+
|    1 | bogummy | 핫뉴스~!!             | 보검이왔어요~!!            | 2020-08-31 09:15:44 |
|    2 | ksh     | 하이염~!              | 수현이예요~~               | 2020-08-31 09:15:44 |
|    3 | parkhj  | 안녕하세요            | 반가워요~^^                | 2020-08-31 09:15:44 |
|    4 | hyekyo  | [끌올]혜교에요~       | 혜교이뻐해주세요~          | 2020-08-31 09:15:44 |
|    5 | parkhj  | 읽지마세요~           | 나 좀 멋진듯~?             | 2020-08-31 09:15:44 |
|    6 | parkbo  | 보영임당~             | 겸둥이보영이에요~!         | 2020-08-31 09:27:37 |
+------+---------+-----------------------+----------------------------+---------------------+
6 rows in set (0.00 sec)


```

#### Drop 뷰 삭제 127p

```
mysql> drop view art_board_list;
Query OK, 0 rows affected (0.00 sec)

mysql> show tables;
+---------------------+
| Tables_in_artist_db |
+---------------------+
| art_board           |
| art_member          |
+---------------------+
2 rows in set (0.00 sec)


```



### 트랜잭션 133p

```
mysql> use naver_db;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+--------------------+
| Tables_in_naver_db |
+--------------------+
| member             |
+--------------------+
1 row in set (0.00 sec)

mysql> start transaction;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into member set id='trtest1', name='트랜잭션1';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where  id='trtest1';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest1 | 트랜잭션1     |
+---------+---------------+
1 row in set (0.00 sec)

```

다른 탭열고 

```
[root@Linux-04 바탕화면]# mysql -u root -pkeroro2424. naver_db
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 14
Server version: 5.1.73 Source distribution

Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> select id, name from member where id='trtest1'
    -> ;
Empty set (0.00 sec)

오류뜸 ! 왜? Commit을 안해서!
```

다시 원래 탭 와서 세이브 포인트 만들고  값 또 추가해보기

```
mysql> savepoint sp1;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into member set id='trest2', name='트랜잭션2';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest1    트랜잭션1
| trtest2    트랜잭션2     |
+---------+---------------+
1 row in set (0.00 sec)

아까로 돌아가기

mysql> rollback to sp1;
Query OK, 0 rows affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest1 | 트랜잭션1     |
+---------+---------------+
1 row in set (0.00 sec)

```

롤백하면 trtest가 들어간 레코드는 다 사라짐

```
mysql> rollback;
Query OK, 0 rows affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
Empty set (0.00 sec)


```

다시 추가해보기

```
mysql> insert into member set id='trtest3', name='트랜잭션3';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
+---------+---------------+
1 row in set (0.00 sec)

mysql> start transaction;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into member set id='trtest4', name='트랜잭션4';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션4     |   // 하지만 아직 commit안돼서 DB에는 아직 trtest3만 있는거임!
+---------+---------------+
2 rows in set (0.00 sec)

mysql> commit; // commit 해서 DB에 연동시키기! = 동시에 트랜잭션은 종료됨
Query OK, 0 rows affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션4     |
+---------+---------------+
2 rows in set (0.00 sec)



```

```
mysql> delete from member where id like 'trtest%';
Query OK, 2 rows affected (0.01 sec)

mysql> select id, name from member where id like 'trtest%';
Empty set (0.00 sec)

mysql> insert into member set id='trtest3', name='트랜잭션3';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
+---------+---------------+
1 row in set (0.00 sec)

mysql> start transaction;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into member set id='trtest4', name='트랜잭션4';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션4     |
+---------+---------------+
2 rows in set (0.00 sec)

mysql> commit;
Query OK, 0 rows affected (0.00 sec)

mysql> start transaction;
Query OK, 0 rows affected (0.00 sec)

mysql> update member set name='트랜잭션5' where id = 'trtest4';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션5     |
+---------+---------------+
2 rows in set (0.00 sec)

```

다른터미널 

```
mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션4     |
+---------+---------------+
2 rows in set (0.00 sec)

mysql> 
mysql> update member set name='트랜잭션6' where id='trtest4';
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
-> 에러뜸!! 시간초과 에러 _ 1번 터미널에서 이 레코드를 사용하기 때문에 다른 사람이 접근하지 못하도록 잠궈놨기 때문. = 시간초과 메세지 = 독립성 = 레코드 단위로 잠굼

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션4     |
+---------+---------------+
2 rows in set (0.00 sec)

원래 터미널에서 commit; 해주고 다시 와서 update 하면 됨!

mysql> update member set name='트랜잭션6' where id='trtest4';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션6     |
| trtest7 | 트랜잭션7     |
+---------+---------------+
3 rows in set (0.00 sec)

```

오토커밋

```
mysql> select @@autocommit;
+--------------+
| @@autocommit |
+--------------+
|            1 |
+--------------+
1 row in set (0.00 sec)

mysql> set autocommit=0;
Query OK, 0 rows affected (0.00 sec)

mysql> select @@autocommit;
+--------------+
| @@autocommit |
+--------------+
|            0 |
+--------------+
1 row in set (0.00 sec)

mysql> insert into member set id='trtest7', name='트랜잭션7';
Query OK, 1 row affected (0.00 sec)

mysql> select id, name from member where id like 'trtest%';
+---------+---------------+
| id      | name          |
+---------+---------------+
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션5     |
| trtest7 | 트랜잭션7     |
+---------+---------------+
3 rows in set (0.00 sec)

mysql> commit;
Query OK, 0 rows affected (0.00 sec)

mysql> set autocommit=1;
Query OK, 0 rows affected (0.00 sec)

mysql> select @@autocommit;
+--------------+
| @@autocommit |
+--------------+
|            1 |
+--------------+
1 row in set (0.00 sec)

```



### 변수 144p

```
mysql> select @name, @age;
+-------+------+
| @name | @age |
+-------+------+
| NULL  | NULL |  // 아직은 선언된게 없기 때문에 NULL 값임
+-------+------+
1 row in set (0.00 sec)

```

#### set 명령어로 선언할 수 있음

```
mysql> set @name='박준수', @age=20;
Query OK, 0 rows affected (0.01 sec)

mysql> select @name, @age;
+-----------+------+
| @name     | @age |
+-----------+------+
| 박준수    |   20 |
+-----------+------+
1 row in set (0.00 sec)

변수 = 값이 바뀜

mysql> set @name='홍길동', @age=25;
Query OK, 0 rows affected (0.00 sec)

mysql> select @name, @age;
+-----------+------+
| @name     | @age |
+-----------+------+
| 홍길동    |   25 |
+-----------+------+
1 row in set (0.00 sec)

넘버 다 1000으로 

mysql> set @d_no=1000;
Query OK, 0 rows affected (0.00 sec)

mysql> select @d_no, name, age from member;
+-------+---------------+------+
| @d_no | name          | age  |
+-------+---------------+------+
|  1000 | 황영주        |   35 |
|  1000 | 설기형        |   33 |
|  1000 | 박철호        |   34 |
|  1000 | 이상훈        |   32 |
|  1000 | 장영숙        |   24 |
|  1000 | 배용진        |   30 |
|  1000 | 박혜빈        |   22 |
|  1000 | 김문수        |   63 |
|  1000 | 차범길        |   49 |
|  1000 | 김길수        |   54 |
|  1000 | 김수련        |   23 |
|  1000 | 정한나        |   58 |
|  1000 | 이명연        |   33 |
|  1000 | 김영숙        |   53 |
|  1000 | 박준수        |   20 |
|  1000 | 케이유저      |   30 |
|  1000 | 트랜잭션3     | NULL |
|  1000 | 트랜잭션6     | NULL |
|  1000 | 트랜잭션7     | NULL |
+-------+---------------+------+
19 rows in set (0.00 sec)

넘버컬럼에 1000이 추가된 값으로 출력됨

mysql> select @v_no:=@d_no + no, name, age from member;
+-------------------+---------------+------+
| @v_no:=@d_no + no | name          | age  |
+-------------------+---------------+------+
|              1001 | 황영주        |   35 |
|              1002 | 설기형        |   33 |
|              1003 | 박철호        |   34 |
|              1004 | 이상훈        |   32 |
|              1005 | 장영숙        |   24 |
|              1006 | 배용진        |   30 |
|              1007 | 박혜빈        |   22 |
|              1008 | 김문수        |   63 |
|              1009 | 차범길        |   49 |
|              1010 | 김길수        |   54 |
|              1011 | 김수련        |   23 |
|              1013 | 정한나        |   58 |
|              1014 | 이명연        |   33 |
|              1015 | 김영숙        |   53 |
|              1016 | 박준수        |   20 |
|              1017 | 케이유저      |   30 |
|              1023 | 트랜잭션3     | NULL |
|              1024 | 트랜잭션6     | NULL |
|              1025 | 트랜잭션7     | NULL |
+-------------------+---------------+------+
19 rows in set (0.01 sec)


```



### Delimiter 저장 프로시저 147p

```
mysql> select * from member; // 원래는 이렇게 명ㅇ령어 끝을 ;로 인식했음
+----+---------+---------------+------+----------+-----------------------------------------+-----------+------+
| no | id      | name          | sex  | post_num | address                                 | tel       | age  |
+----+---------+---------------+------+----------+-----------------------------------------+-----------+------+
|  1 | yjhwang | 황영주        | M    | 100-011  | 서울시 중구 충무로1가                   | 234-8879  |   35 |
|  2 | khshul  | 설기형        | M    | 607-010  | 부산시 동래구 명륜동                    | 764-3784  |   33 |
|  3 | chpark  | 박철호        | M    | 503-200  | 서울시 동대문구 왕십리                  | 298-9730  |   34 |
|  4 | shlee   | 이상훈        | M    | 503-200  | 광주시 남구 도금동                      | 838-4347  |   32 |
|  5 | jyjang  | 장영숙        | W    | 503-201  | 부산시 영도구 봉래동5가                 | 399-9809  |   24 |
|  6 | yjbae   | 배용진        | M    | 606-065  | 서울시 은평구 응암4동                   | 857-5683  |   30 |
|  7 | hbpark  | 박혜빈        | W    | 122-014  | 경기도 과천시 중앙동                    | 234-7677  |   22 |
|  8 | mskim   | 김문수        | M    | 427-760  | 경기도 시흥시 신천동                    | 370-6003  |   63 |
|  9 | bkcha   | 차범길        | M    | 429-020  | 대전시 서구 둔산1동                     | 432-9877  |   49 |
| 10 | kskim   | 김길수        | M    | 302-121  | 경기도 수원시 장안구 파장동             | 324-5875  |   54 |
| 11 | srkim   | 김수련        | M    | 440-747  | 대구시 달서구 신당동                    | 987-3688  |   23 |
| 13 | hnjang  | 정한나        | W    | 441-081  | 광주시 서구 화정4동                     | 845-4547  |   58 |
| 14 | mylee   | 이명연        | W    | 502-791  | 광주시 서구 쌍촌동                      | 837-9432  |   33 |
| 15 | yskim   | 김영숙        | W    | 429-010  | 경기도 시흥시 대야동                    | 374-8438  |   53 |
| 16 | kuser   | 박준수        | M    | 135-933  | 서울시 강남구 역삼동                    | 1544-9970 |   20 |
| 17 | ktest   | 케이유저      | W    | NULL     | NULL                                    | NULL      |   30 |
| 23 | trtest3 | 트랜잭션3     | NULL | NULL     | NULL                                    | NULL      | NULL |
| 24 | trtest4 | 트랜잭션6     | NULL | NULL     | NULL                                    | NULL      | NULL |
| 25 | trtest7 | 트랜잭션7     | NULL | NULL     | NULL                                    | NULL      | NULL |
+----+---------+---------------+------+----------+-----------------------------------------+-----------+------+
19 rows in set (0.00 sec)

프로시저 = 여러개의 sql을 묶어서 실행한다.
; 을 끝으로 인식하지 않는다
끝으로 인식하는 명령어는 Delimiter
  
mysql> delimiter //   //이걸 명령어의 끝으로 바꿔줌
mysql> select id, name from member; // ;을 써도 명령어가 끝나지 않음
    -> //   //이게 명령어의 끝
+---------+---------------+
| id      | name          |
+---------+---------------+
| yjhwang | 황영주        |
| khshul  | 설기형        |
| chpark  | 박철호        |
| shlee   | 이상훈        |
| jyjang  | 장영숙        |
| yjbae   | 배용진        |
| hbpark  | 박혜빈        |
| mskim   | 김문수        |
| bkcha   | 차범길        |
| kskim   | 김길수        |
| srkim   | 김수련        |
| hnjang  | 정한나        |
| mylee   | 이명연        |
| yskim   | 김영숙        |
| kuser   | 박준수        |
| ktest   | 케이유저      |
| trtest3 | 트랜잭션3     |
| trtest4 | 트랜잭션6     |
| trtest7 | 트랜잭션7     |
+---------+---------------+
19 rows in set (0.00 sec)

```

#### ARGUMENT 인자값

```
mysql> create procedure test1 ()
    -> begin 
    -> select * from member where age < 30;
    -> select * from member where address like '서울%';
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;

프로시져가 적용된 DB 확인해보기

mysql> show procedure status;
+----------+-------+-----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+
| Db       | Name  | Type      | Definer        | Modified            | Created             | Security_type | Comment | character_set_client | collation_connection | Database Collation |
+----------+-------+-----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+
| naver_db | test1 | PROCEDURE | root@localhost | 2020-08-31 11:11:23 | 2020-08-31 11:11:23 | DEFINER       |         | utf8                 | utf8_general_ci      | utf8_general_ci    |
+----------+-------+-----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+
1 row in set (0.00 sec)

무슨 코드가 들어갔는지 보고싶다

mysql> show create procedure test1;
+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
| Procedure | sql_mode | Create Procedure                                                                                                                                         | character_set_client | collation_connection | Database Collation |
+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
| test1     |          | CREATE DEFINER=`root`@`localhost` PROCEDURE `test1`()
begin 
select * from member where age < 30;
select * from member where address like '서울%';
end   | utf8                 | utf8_general_ci      | utf8_general_ci    |
+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
1 row in set (0.01 sec)

잘못쳐서 프로시져를 변경하고 싶다 -> 변경 안됨... 걍 프로시져 지우고 다시 재생성 하는 방법밖에 없음

두개의 sql문이 동시에 동작

mysql> call test1;
+----+--------+-----------+------+----------+-----------------------------------+-----------+------+
| no | id     | name      | sex  | post_num | address                           | tel       | age  |
+----+--------+-----------+------+----------+-----------------------------------+-----------+------+
|  5 | jyjang | 장영숙    | W    | 503-201  | 부산시 영도구 봉래동5가           | 399-9809  |   24 |
|  7 | hbpark | 박혜빈    | W    | 122-014  | 경기도 과천시 중앙동              | 234-7677  |   22 |
| 11 | srkim  | 김수련    | M    | 440-747  | 대구시 달서구 신당동              | 987-3688  |   23 |
| 16 | kuser  | 박준수    | M    | 135-933  | 서울시 강남구 역삼동              | 1544-9970 |   20 |
+----+--------+-----------+------+----------+-----------------------------------+-----------+------+
4 rows in set (0.00 sec)

+----+---------+-----------+------+----------+----------------------------------+-----------+------+
| no | id      | name      | sex  | post_num | address                          | tel       | age  |
+----+---------+-----------+------+----------+----------------------------------+-----------+------+
|  1 | yjhwang | 황영주    | M    | 100-011  | 서울시 중구 충무로1가            | 234-8879  |   35 |
|  3 | chpark  | 박철호    | M    | 503-200  | 서울시 동대문구 왕십리           | 298-9730  |   34 |
|  6 | yjbae   | 배용진    | M    | 606-065  | 서울시 은평구 응암4동            | 857-5683  |   30 |
| 16 | kuser   | 박준수    | M    | 135-933  | 서울시 강남구 역삼동             | 1544-9970 |   20 |
+----+---------+-----------+------+----------+----------------------------------+-----------+------+
4 rows in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)


```

#### drop 프로시져 삭제 

```
mysql> drop procedure test1;
Query OK, 0 rows affected (0.00 sec)

mysql> show procedure status;
Empty set (0.00 sec)

```



```
mysql> delimiter //
mysql> create procedure arg_test (p_id varchar(32))  //여기 p_id랑
    -> begin
    -> select * from member where id=p_id; // id랑 같으면 안됨
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;

호출할 때는 값만 넣어주기

mysql> call arg_test('shlee');
+----+-------+-----------+------+----------+----------------------------+----------+------+
| no | id    | name      | sex  | post_num | address                    | tel      | age  |
+----+-------+-----------+------+----------+----------------------------+----------+------+
|  4 | shlee | 이상훈    | M    | 503-200  | 광주시 남구 도금동         | 838-4347 |   32 |
+----+-------+-----------+------+----------+----------------------------+----------+------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call arg_test('mskim');
+----+-------+-----------+------+----------+-------------------------------+----------+------+
| no | id    | name      | sex  | post_num | address                       | tel      | age  |
+----+-------+-----------+------+----------+-------------------------------+----------+------+
|  8 | mskim | 김문수    | M    | 427-760  | 경기도 시흥시 신천동          | 370-6003 |   63 |
+----+-------+-----------+------+----------+-------------------------------+----------+------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)



```

####  Declare 

```
mysql> create procedure var_test ()
    -> begin
    -> declare name varchar(32)
    -> ;
    -> declare age int default 1;
    -> set name='홍길동';
    -> select name, age;
    -> end //
Query OK, 0 rows affected (0.01 sec)

mysql> call var_test;
    -> //
+-----------+------+
| name      | age  |
+-----------+------+
| 홍길동    |    1 |
+-----------+------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;
mysql> call var_test;
+-----------+------+
| name      | age  |
+-----------+------+
| 홍길동    |    1 |
+-----------+------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

```

#### IF 조건문 155p

```
mysql> delimiter //
mysql> create procedure if_test (num int)
    -> begin
    -> if num > 0 then 
    -> select '0보다 큼' as result;
    -> elseif num < 0 then
    -> select '0과 같음' as result;
    -> else
    -> select '0과 같음' as result;
    -> end if;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter //
mysql> create procedure if_test (num int)
    -> begin
    -> if num > 0 then 
    -> select '0보다 큼' as result;
    -> elseif num < 0 then
    -> select '0보다 작음' as result;
    -> else
    -> select '0과 같음' as result;
    -> end if;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> call if_test(10);
    -> //
+-------------+
| result      |
+-------------+
| 0보다 큼    |
+-------------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;
mysql> call if_test(10);
+-------------+
| result      |
+-------------+
| 0보다 큼    |
+-------------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call if_test(-5);
+-------------+
| result      |
+-------------+
| 0보다 작음    |
+-------------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call if_test(0);
+-------------+
| result      |
+-------------+
| 0과 같음    |
+-------------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

+ 
call if_test(0); 이라면?
if 문은 첫번째 부터 다 비교를 하며 밑으로 내려오기 때문에 하나하나 비교 해 보고 0과 같음 출력 -> 종료

+
call if_test(1);
조건에 맞지 그럼 바로 0보다 큼 실행하고 마지막으로 가서 종료

```

#### case 문 선택문

```
mysql> delimiter //
mysql> create procedure case_test (num int)
    -> begin
    -> case num
    -> when 1 then
    -> select '월요일';
    -> when 2 then 
    -> select '화요일';
    -> when 3 then
    -> select '수요일';
    -> else
    -> select '잘못입력';
    -> end case;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;
mysql> call case_test(1);
+-----------+
| 월요일    |
+-----------+
| 월요일    |
+-----------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call case_test(2);
+-----------+
| 화요일    |
+-----------+
| 화요일    |
+-----------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call case_test(3);
+-----------+
| 수요일    |
+-----------+
| 수요일    |
+-----------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call case_test(5);
+--------------+
| 잘못입력     |
+--------------+
| 잘못입력     |
+--------------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)



+
case_test(2) -> 화요일 출력 -> end case;

case는 if와 다르게 처음부터 다 비교하면서 내려오는게 아니고 num 값을 찾아서 바로 출력
```

####  if VS case

- IF = 맨 위에서부터 하나하나 비교해보면서 내려오고 맞는 값이면 출력하고 종료
- Case = num 값을 보고 찾아서 바로 출력 후 종료



#### While 반복문 157p

```
mysql> delimiter //
mysql> create procedure while_test (count int)
    -> begin
    -> declare tmp int default 0;
    -> while tmp < count do
    -> select tmp;
    -> set tmp = tmp + 1;
    -> end while;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;

mysql> call while_test(2);
+------+
| tmp  |
+------+
|    0 |
+------+
1 row in set (0.00 sec)

+------+
| tmp  |
+------+
|    1 |
+------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call while_test(4);
+------+
| tmp  |
+------+
|    0 |
+------+
1 row in set (0.00 sec)

+------+
| tmp  |
+------+
|    1 |
+------+
1 row in set (0.00 sec)

+------+
| tmp  |
+------+
|    2 |
+------+
1 row in set (0.00 sec)

+------+
| tmp  |
+------+
|    3 |
+------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)


+
0 < 2
tmp = 0
tmp = 1

-------

1 < 2
tmp = 1
tmp = 2


```



### 실습 

점수 3개를 입력 받아 평균이 60점 이상이고 

각 점수가 40점 이상이면 합격, 아니면 '평균 불합격'인지,

'과목 불합격' 인지 사유를 출력하시오.

힌트 : call procedure (arg1, arg2, arg3); 이용 해 보세요

kor : 국어점수

eng : 영어점수

math : 수학점수



sum (kor + eng + math ) : 합계

avg (sum/3) : 평균

합격 : avg >= 60 and kor >= 40 and eng >= 40 and math >= 40

평균 불합격 : avg <60

과목 불합격 : 나머지



```

mysql> delimiter //
mysql> create procedure exam_test (kor int, eng int, math int)
    -> begin
    -> declare sum int;
    -> declare avg float;
    -> set sum = kor + eng + math;
    -> set avg = sum /3;
    -> if avg >= 60 and kor >= 40 and eng >= 40 and math >= 40 then
    -> select '합격' as result;
    -> elseif avg < 60 then
    -> select '평균 불합격' as result;
    -> else
    -> select '과목 불합격' as result;
    -> end if;
    -> end //
Query OK, 0 rows affected (0.00 sec)


mysql> delimiter ;
mysql> call exam_test (60,65,70);
+--------+
| result |
+--------+
| 합격   |
+--------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> call exam_test(100,80,35);
+------------------+
| result           |
+------------------+
| 과목 불합격      |
+------------------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)


```



### 곤륜검의 공격력을 10 증가시키는 프로시져 만들어보기

```
mysql> use bns;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> select * from sword;
+-----------+---------+----------+
| s_name    | s_level | s_attack |
+-----------+---------+----------+
| 곤륜검    |      50 |      540 |
| 염화검    |      36 |      147 |
| 요마검    |      20 |       64 |
| 풍뢰검    |      45 |      263 |
+-----------+---------+----------+
4 rows in set (0.00 sec)

mysql> delimiter //
mysql> create procedure item_atk_up ()
    -> begin
    -> declare item_atk int;
    -> select s_attack into item_atk from sword where s_name='곤륜검';
    -> set item_atk = item_atk + 10;
    -> update sword set s_attack = item_atk where s_name='곤륜검';
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;
mysql> call item_atk_up;
Query OK, 1 row affected (0.01 sec)

mysql> select * from sword;
+-----------+---------+----------+
| s_name    | s_level | s_attack |
+-----------+---------+----------+
| 곤륜검    |      50 |      550 |
| 염화검    |      36 |      147 |
| 요마검    |      20 |       64 |
| 풍뢰검    |      45 |      263 |
+-----------+---------+----------+
4 rows in set (0.00 sec)


```



### 특정 아이템의 공격력을 원하는 수치만큼 증가하는 프로시져 만들어보기

```
mysql> show tables;
+---------------+
| Tables_in_bns |
+---------------+
| market        |
| staff         |
| sword         |
+---------------+
3 rows in set (0.00 sec)

mysql> delimiter //
mysql> create procedure item_atk_update (name varchar(32), num int)
    -> begin
    -> declare item_atk int;
    -> 
    -> if name like '%검' then
    -> select s_attack into item_atk from sword where s_name=name;
    -> set item_atk = item_atk + num;
    -> update sword set s_attack = item_atk where s_name=name;
    -> elseif name like '%지팡이' then
    -> select f_attack into item_atk from staff where f_name=name;
    -> set item_atk = item_atk + num;
    -> update staff set f_attack = item_atk where f_name=name;
    -> else
    -> select '그런 아이템 카테고리는 없습니다' as result;
    -> end if;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> 
mysql> delimiter ;

mysql> select * from sword;
+-----------+---------+----------+
| s_name    | s_level | s_attack |
+-----------+---------+----------+
| 곤륜검    |      50 |      550 |
| 염화검    |      36 |      147 |
| 요마검    |      20 |       64 |
| 풍뢰검    |      45 |      263 |
+-----------+---------+----------+
4 rows in set (0.00 sec)

mysql> call item_atk_update ('염화검' ,20);
Query OK, 1 row affected (0.00 sec)

mysql> select * from sword;
+-----------+---------+----------+
| s_name    | s_level | s_attack |
+-----------+---------+----------+
| 곤륜검    |      50 |      550 |
| 염화검    |      36 |      167 |
| 요마검    |      20 |       64 |
| 풍뢰검    |      45 |      263 |
+-----------+---------+----------+
4 rows in set (0.00 sec)

mysql> call item_atk_update ('염화검' ,-10);
Query OK, 1 row affected (0.00 sec)

mysql> select * from sword;
+-----------+---------+----------+
| s_name    | s_level | s_attack |
+-----------+---------+----------+
| 곤륜검    |      50 |      550 |
| 염화검    |      36 |      157 |
| 요마검    |      20 |       64 |
| 풍뢰검    |      45 |      263 |
+-----------+---------+----------+
4 rows in set (0.00 sec)

mysql> select * from staff;
+-----------------+---------+----------+
| f_name          | f_level | f_attack |
+-----------------+---------+----------+
| 유성지팡이      |      50 |      400 |
| 촉마지팡이      |      50 |      311 |
+-----------------+---------+----------+
2 rows in set (0.00 sec)

mysql> call item_atk_update ('촉마지팡이', 100);
Query OK, 1 row affected (0.01 sec)

mysql> select * from staff;
+-----------------+---------+----------+
| f_name          | f_level | f_attack |
+-----------------+---------+----------+
| 유성지팡이      |      50 |      400 |
| 촉마지팡이      |      50 |      411 |
+-----------------+---------+----------+
2 rows in set (0.00 sec)

mysql> call item_atk_update ('촉마지팡이', -50);
Query OK, 1 row affected (0.00 sec)

mysql> select * from staff;
+-----------------+---------+----------+
| f_name          | f_level | f_attack |
+-----------------+---------+----------+
| 유성지팡이      |      50 |      400 |
| 촉마지팡이      |      50 |      361 |
+-----------------+---------+----------+
2 rows in set (0.00 sec)


```



### Stored Function 저장 함수 159p

프로시져와 달리 반환값이 있다는 점이 가장 큰 특징

```
mysql> delimiter //
mysql> create function func_test (num1 int, num2 int ) returns int
    -> begin
    -> return num1 + num2 ;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;
mysql> show function status;
+-----+-----------+----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+
| Db  | Name      | Type     | Definer        | Modified            | Created             | Security_type | Comment | character_set_client | collation_connection | Database Collation |
+-----+-----------+----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+
| bns | func_test | FUNCTION | root@localhost | 2020-08-31 16:10:50 | 2020-08-31 16:10:50 | DEFINER       |         | utf8                 | utf8_general_ci      | utf8_general_ci    |
+-----+-----------+----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+
1 row in set (0.00 sec)

mysql> show create function func_test;
+-----------+----------+----------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
| Function  | sql_mode | Create Function                                                                                                            | character_set_client | collation_connection | Database Collation |
+-----------+----------+----------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
| func_test |          | CREATE DEFINER=`root`@`localhost` FUNCTION `func_test`(num1 int, num2 int ) RETURNS int(11)
begin
return num1 + num2 ;
end | utf8                 | utf8_general_ci      | utf8_general_ci    |
+-----------+----------+----------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
1 row in set (0.00 sec)

mysql> select func_test(50,60);
+------------------+
| func_test(50,60) |
+------------------+
|              110 |
+------------------+
1 row in set (0.00 sec)

```

#### Function 삭제 = Drop 

```
mysql> drop function func_test;
Query OK, 0 rows affected (0.00 sec)

mysql> show function status;
Empty set (0.00 sec)

```

if문,  case문 다 사용 가능



### 저장 함수 실습 163p

- 숫자 두 개를 입력 받아서 작은 수에서 큰 수 까지의 합을 연산하는 함수 작성

  ex) select sum_func(10,20);

- 연산 : 10+11+12+...+20

- 결과값 출력

  

```
mysql> delimiter //
mysql> create function sum_func(num1 int, num2 int) returns int
    -> begin
    -> declare tmp int;
    -> if num1 > num2 then
    -> set tmp = num1;
    -> set num1 = num2;
    -> set num2 = tmp;
    -> end if;
    -> set tmp = 0;
    -> while num1 <= num2 do
    -> set tmp = tmp + num1;
    -> set num1 = num1 + 1;
    -> end while;
    -> return tmp;
    -> end //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;

mysql> select sum_func(10,20);
+-----------------+
| sum_func(10,20) |
+-----------------+
|             165 |
+-----------------+
1 row in set (0.00 sec)

mysql> select sum_func(20,10);
+-----------------+
| sum_func(20,10) |
+-----------------+
|             165 |
+-----------------+
1 row in set (0.00 sec)

```

### 트리거 164p

```
mysql> use naver_db;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> create table trig_test (
    -> event_time char(15),
    -> count int unsigned
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> insert into trig_test values ('insert_before',0);
Query OK, 1 row affected (0.00 sec)

mysql> insert into trig_test values ('insert_after', 0);
Query OK, 1 row affected (0.00 sec)

mysql> insert into trig_test values ('update_before', 0);
Query OK, 1 row affected (0.00 sec)

mysql> insert into trig_test values ('update_after', 0);
Query OK, 1 row affected (0.00 sec)

mysql> insert into trig_test values ('delete_before', 0);
Query OK, 1 row affected (0.00 sec)

mysql> insert into trig_test values ('delete_after', 0);
Query OK, 1 row affected (0.00 sec)

mysql> select * from trig_test;
+---------------+-------+
| event_time    | count |
+---------------+-------+
| insert_before |     0 |
| insert_after  |     0 |
| update_before |     0 |
| update_after  |     0 |
| delete_before |     0 |
| delete_after  |     0 |
+---------------+-------+
6 rows in set (0.00 sec)


```

#### 트리거 생성 167p

```
mysql> delimiter //
mysql> create trigger trig_test after update on member
    -> for each row
    -> begin
    -> update trig_test set count = count + 1 where event_time = 'update_after';
    -> end //
Query OK, 0 rows affected (0.00 sec)

-> 실행문이 한 줄 일때 begin 과 end 생략 가능 = delimiter도 생략 가능

mysql> delimiter ;

mysql> show triggers;
+-----------+--------+--------+-------------------------------------------------------------------------------------+--------+---------+----------+----------------+----------------------+----------------------+--------------------+
| Trigger   | Event  | Table  | Statement                                                                           | Timing | Created | sql_mode | Definer        | character_set_client | collation_connection | Database Collation |
+-----------+--------+--------+-------------------------------------------------------------------------------------+--------+---------+----------+----------------+----------------------+----------------------+--------------------+
| trig_test | UPDATE | member | begin
update trig_test set count = count + 1 where event_time = 'update_after';
end | AFTER  | NULL    |          | root@localhost | utf8                 | utf8_general_ci      | utf8_general_ci    |
+-----------+--------+--------+-------------------------------------------------------------------------------------+--------+---------+----------+----------------+----------------------+----------------------+--------------------+
1 row in set (0.00 sec)


```

#### 지우는건 DROP

```
mysql> drop trigger trig_test;
Query OK, 0 rows affected (0.00 sec)

mysql> show triggers;
Empty set (0.00 sec)

```

#### 한줄일 때 begin, end 생략가능하단거 

```
mysql> create trigger trig_test after update on member
    -> for each row
    -> update trig_test set count = count + 1 where event_time = 'update_after';
Query OK, 0 rows affected (0.00 sec)

이런식으로 begin, end, delimiter 생략 가능
```

#### 트리거 동작 확인 (이벤트)

```
mysql> update member set sex='남' where sex='M';
Query OK, 10 rows affected (0.00 sec)
Rows matched: 10  Changed: 10  Warnings: 0

mysql> select * from trig_test;
+---------------+-------+
| event_time    | count |
+---------------+-------+
| insert_before |     0 |
| insert_after  |     0 |
| update_before |     0 |
| update_after  |    10 |
| delete_before |     0 |
| delete_after  |     0 |
+---------------+-------+
6 rows in set (0.00 sec)

mysql> update member set sex='여' where sex='W';
Query OK, 6 rows affected (0.01 sec)
Rows matched: 6  Changed: 6  Warnings: 0

mysql> select * from trig_test;
+---------------+-------+
| event_time    | count |
+---------------+-------+
| insert_before |     0 |
| insert_after  |     0 |
| update_before |     0 |
| update_after  |    16 |
| delete_before |     0 |
| delete_after  |     0 |
+---------------+-------+
6 rows in set (0.00 sec)



```

#### 트리거 삭제 = drop

#### 실습 트리거 173p

```

```











